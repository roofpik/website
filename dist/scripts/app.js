function reviewRatings(){return{restrict:"AE",replace:!0,template:'<div class="text-center review_ratings"><span ng-style="iconOffColor" ng-click="ratingsClicked(1)" ng-if="rating < 1" ng-class="{\'read_only\':(readOnly)}"><i class="material-icons">star_border</i></span><span ng-style="iconOnColor" ng-click="ratingsUnClicked(1)" ng-if="rating > 0" ng-class="{\'read_only\':(readOnly)}"><i class="material-icons">star</i></span><span ng-style="iconOffColor" ng-click="ratingsClicked(2)" ng-if="rating < 2" ng-class="{\'read_only\':(readOnly)}"><i class="material-icons">star_border</i></span><span ng-style="iconOnColor" ng-click="ratingsUnClicked(2)" ng-if="rating > 1" ng-class="{\'read_only\':(readOnly)}"><i class="material-icons">star</i></span><span ng-style="iconOffColor" ng-click="ratingsClicked(3)" ng-if="rating < 3" ng-class="{\'read_only\':(readOnly)}"><i class="material-icons">star_border</i></span><span ng-style="iconOnColor" ng-click="ratingsUnClicked(3)" ng-if="rating > 2" ng-class="{\'read_only\':(readOnly)}"><i class="material-icons">star</i></span><span ng-style="iconOffColor" ng-click="ratingsClicked(4)" ng-if="rating < 4" ng-class="{\'read_only\':(readOnly)}"><i class="material-icons">star_border</i></span><span ng-style="iconOnColor" ng-click="ratingsUnClicked(4)" ng-if="rating > 3" ng-class="{\'read_only\':(readOnly)}"><i class="material-icons">star</i></span><span ng-style="iconOffColor" ng-click="ratingsClicked(5)" ng-if="rating < 5" ng-class="{\'read_only\':(readOnly)}"><i class="material-icons">star_border</i></span><span ng-style="iconOnColor" ng-click="ratingsUnClicked(5)" ng-if="rating > 4" ng-class="{\'read_only\':(readOnly)}"><i class="material-icons">star</i></span></div>',scope:{ratingsObj:"=ratingsobj",index:"=index"},link:function(scope,element,attrs){function setRating(val,uiEvent){0!==scope.minRating&&val<scope.minRating?scope.rating=scope.minRating:scope.rating=val,scope.prevRating=val,uiEvent&&scope.ratingsObj.callback(scope.rating,scope.index)}scope.iconOnColor=scope.ratingsObj.iconOnColor||"rgb(43, 187, 173)",scope.iconOffColor=scope.ratingsObj.iconOffColor||"rgb(140, 140, 140)",scope.rating=scope.ratingsObj.rating||0,scope.minRating=scope.ratingsObj.minRating||0,scope.readOnly=scope.ratingsObj.readOnly||!1,scope.index=scope.index||0,scope.iconOnColor={color:scope.iconOnColor},scope.iconOffColor={color:scope.iconOffColor},scope.rating=scope.rating>scope.minRating?scope.rating:scope.minRating,scope.prevRating=0,scope.$watch("ratingsObj.rating",function(newValue,oldValue){setRating(newValue)}),scope.ratingsClicked=function(val){setRating(val,!0)},scope.ratingsUnClicked=function(val){0!==scope.minRating&&val<scope.minRating?scope.rating=scope.minRating:scope.rating=val,scope.prevRating==val&&(0!==scope.minRating?scope.rating=scope.minRating:scope.rating=0),scope.prevRating=val,scope.ratingsObj.callback(scope.rating,scope.index)}}}}function deleteLocalStorage(name){localStorage.removeItem(name)}function checkLocalStorage(name){return null===localStorage.getItem(name)?!1:!0}function camelCaseToTitleCase(camelCase){if(null==camelCase||""==camelCase)return camelCase;camelCase=camelCase.trim();for(var newText="",i=0;i<camelCase.length;i++)/[A-Z]/.test(camelCase[i])&&0!=i&&/[a-z]/.test(camelCase[i-1])&&(newText+=" "),newText+=0==i&&/[a-z]/.test(camelCase[i])?camelCase[i].toUpperCase():camelCase[i];return newText}var app=angular.module("roofpikWeb",["ui.router"]),config={apiKey:"AIzaSyBSSYFQ2ZhbF7d0fwTIiHVOL1GTHAWpilA",authDomain:"roofpik-new.firebaseapp.com",databaseURL:"https://roofpik-new.firebaseio.com",storageBucket:"roofpik-new.appspot.com",messagingSenderId:"362004565118"};firebase.initializeApp(config);var db=firebase.database();app.run(function($rootScope,$timeout){$rootScope.loginStatus=!1,$rootScope.uid=null,firebase.auth().onAuthStateChanged(function(user){user&&null==$rootScope.uid?($rootScope.uid=user.uid,$rootScope.loginStatus=!0,$rootScope.$emit("loggedIn"),localStorage.setItem("loginStatus",!0),localStorage.setItem("uid",JSON.stringify(user.uid)),$rootScope.photoURL=user.photoURL,$rootScope.displayName=user.displayName):($rootScope.uid=null,$rootScope.loginStatus=!1,localStorage.setItem("loginStatus",!1),deleteLocalStorage("uid"))}),$rootScope.$on("$stateChangeStart",function(){})}),app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function($stateProvider,$urlRouterProvider,$locationProvider){$locationProvider.hashPrefix(""),$stateProvider.state("home",{url:"/home",views:{"":{templateUrl:"resources/home/views/home.html",controller:"homeCtrl"},"search@home":{templateUrl:"resources/home/views/search.html",controller:"searchCtrl"},"microMarkets@home":{templateUrl:"resources/home/views/micro-markets.html",controller:"microMarketsCtrl"},"popularSearches@home":{templateUrl:"resources/home/views/popular-searches.html",controller:"popularSearchCtrl"}}}),$stateProvider.state("story",{url:"/story/gurgaon",templateUrl:"resources/story/story.html"}),$stateProvider.state("write-review",{url:"/write-review?key&name&type",templateUrl:"resources/review/views/write-review.html",controller:"writeReviewCtrl"}),$stateProvider.state("about-us",{url:"/about-us",templateUrl:"resources/static/about.html"}),$stateProvider.state("advertise",{url:"/advertise",templateUrl:"resources/static/advertise.html"}),$stateProvider.state("business-advantage",{url:"/business-advantage",templateUrl:"resources/static/business-advantage.html"}),$stateProvider.state("careers",{url:"/careers",templateUrl:"resources/static/careers.html"}),$stateProvider.state("comparison",{url:"/comparison",templateUrl:"resources/static/comparison.html"}),$stateProvider.state("contact-us",{url:"/contact-us",templateUrl:"resources/static/contact-us.html"}),$stateProvider.state("corporate",{url:"/corporate",templateUrl:"resources/static/corporate.html"}),$stateProvider.state("guidelines",{url:"/guidelines",templateUrl:"resources/static/guidelines.html"}),$stateProvider.state("homecoverstories",{url:"/homecoverstories",templateUrl:"resources/static/homecoverstories.html"}),$stateProvider.state("location",{url:"/location",templateUrl:"resources/static/location.html"}),$stateProvider.state("marketing",{url:"/marketing",templateUrl:"resources/static/marketing.html"}),$stateProvider.state("requirement",{url:"/requirement",templateUrl:"resources/static/requirement.html"}),$stateProvider.state("verified",{url:"/verified",templateUrl:"resources/static/verified.html"}),$stateProvider.state("project-details",{url:"/rent/property/2017/gurgaon/residential/:micro/:locality/:builder/:project",templateUrl:"resources/projects/projects/project-details.html",controller:"projectDetailsCtrl"}),$stateProvider.state("listing",{url:"/search/2017/property/gurgaon/residential/:location",templateUrl:"resources/projects/projects/listing.html",controller:"listingCtrl"}),$stateProvider.state("micromarket-details",{url:"/micromarket-details?city&micro",templateUrl:"resources/location/location/micromarket-details.html",controller:"micromarketDetailsCtrl"}),$stateProvider.state("locality-details",{url:"/locality-details?city&micro&loc",templateUrl:"resources/location/location/locality-details.html",controller:"localityDetailsCtrl"}),$stateProvider.state("city-details",{url:"/city-details?city",templateUrl:"resources/location/location/city-details.html",controller:"cityDetailsCtrl"}),$urlRouterProvider.otherwise("/home")}]),app.directive("loading",function(){return{restrict:"EA",replace:!1,templateUrl:"resources/general/views/loading.html"}}),app.directive("header",function(){return{restrict:"EA",replace:!1,templateUrl:"resources/general/views/header.html",controller:"headerCtrl"}}),app.controller("headerCtrl",function($scope,$timeout,$rootScope,$state){$scope.user={},$scope.loginStatus=!1,$scope.$watch("loginStatus",function(){$timeout(function(){$scope.loginStatus=$rootScope.loginStatus,$rootScope.loginStatus?$scope.user=firebase.auth().currentUser:($scope.user={},$scope.user.photoURL=null,$scope.user.displayName=null)},0)}),$scope.gotoHome=function(){$state.go("home")},$rootScope.$on("loggedIn",function(){console.log("called"),$timeout(function(){$scope.user=firebase.auth().currentUser,$scope.loginStatus=!0},0)}),$scope.logout=function(){swal({title:"Logout!",text:"Are You Sure You Want To Logout?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, log me out!",closeOnConfirm:!0},function(){firebase.auth().signOut().then(function(response){$timeout(function(){$rootScope.uid=null,$timeout(function(){$rootScope.loginStatus=!1,$scope.user={},$scope.user.photoURL=null,$scope.user.displayName=null,$scope.loginStatus=!1},0),localStorage.setItem("loginStatus",!1),sweetAlert("Logout Successful","You have successfully logged out!","success")},100)},function(error){(new Date).getTime()})})},$("#login_signup_popup").modal({dismissible:!1}),$scope.openLogin=function(){$("#login_signup_popup").modal({dismissible:!1}),$("#login_signup_popup").modal("open")},$(".button-collapse").sideNav({menuWidth:300,edge:"left",closeOnClick:!0,draggable:!0})}),app.directive("footer",function(){return{restrict:"A",replace:!1,scope:{user:"=?"},templateUrl:"resources/general/views/footer.html"}}),app.directive("login",function(){return{restrict:"A",replace:!0,templateUrl:"resources/general/views/login.html",controller:"loginCtrl"}}),app.controller("loginCtrl",function($scope,$http,$timeout,$rootScope){function registerUser(){db.ref("users/"+$scope.data.uid).once("value",function(snapshot){snapshot.val()?($("#login_signup_popup").modal("close"),Materialize.toast("You have successfully loggedin!",1500)):(updates={},$timeout(function(){$scope.login.signup=!1,$scope.login.mobile=!0},1e3),updates["users/"+$scope.data.uid]=$scope.data,db.ref().update(updates).then(function(){$scope.data={}}))})}$scope.login={},$scope.login.signup=!0,$scope.login.mobile=!1;var uid="";$scope.fbLogin=function(){var provider=new firebase.auth.FacebookAuthProvider;provider.addScope("email"),firebase.auth().signInWithPopup(provider).then(function(result){var token=result.credential.accessToken,user=result.user;$scope.data={},$scope.data.email={},$scope.data.facebook={},$scope.data.fname=user.displayName,$scope.data.uid=user.uid,uid=user.uid,$scope.data.profileImage=user.photoURL,$scope.data.createdDate=(new Date).getTime(),$scope.data.registeredFlag=!0,$scope.data.welcomeEmailSent=!1,$scope.data.email.emailAddress=user.providerData[0].email,$scope.data.email.emailVerified=!0,$scope.data.facebook.active=!0,$scope.data.facebook.fid=user.providerData[0].uid,$scope.data.facebook.photoURL=user.providerData[0].photoURL,$scope.data.facebook.token=token,user.providerData[0].email&&!user.email&&user.updateEmail(user.providerData[0].email).then(function(){},function(error){console.log(error)}),registerUser()})["catch"](function(error){error.code,error.message,error.email,error.credential;sweetAlert("error",error.message,"error")})},$scope.googleLogin=function(){firebase.auth().signOut();var provider=new firebase.auth.GoogleAuthProvider;provider.addScope("https://www.googleapis.com/auth/plus.login"),provider.addScope("email"),firebase.auth().signInWithPopup(provider).then(function(result){var token=result.credential.accessToken,user=result.user;$scope.data={},$scope.data.email={},$scope.data.google={},$scope.data.fname=user.displayName,$scope.data.uid=user.uid,uid=user.uid,$scope.data.profileImage=user.photoURL,$scope.data.createdDate=(new Date).getTime(),$scope.data.registeredFlag=!0,$scope.data.welcomeEmailSent=!1,$scope.data.email.emailAddress=user.providerData[0].email,$scope.data.email.emailVerified=!0,$scope.data.google.active=!0,$scope.data.google.gid=user.providerData[0].uid,$scope.data.google.photoURL=user.providerData[0].photoURL,$scope.data.google.token=token,user.providerData[0].email&&user.updateEmail(user.providerData[0].email).then(function(){},function(error){console.log(error)}),registerUser()})["catch"](function(error){error.code,error.message,error.email,error.credential;sweetAlert(error.code,error.message,"error")})};var otp={};$scope.process=!1,$scope.sendOtp=function(){$scope.process=!0,$scope.loadingMsg="Sending OTP",$timeout(function(){$scope.process=!1},8e3),$http({url:"http://139.162.9.71/api/sendotp",method:"POST",data:{mobile:$scope.user.mobile}}).then(function(response){200==response.data.status?(time=(new Date).getTime(),otp[time]=response.data.otp,$scope.login.otp=!0):sweetAlert("error","Something went wrong, please try again","error"),$scope.process=!1})},$scope.verifyOtp=function(){$scope.process=!0,$scope.loadingMsg="Verifying OTP",rightOtp=!1;for(item in otp)($scope.user.otp==otp[item]||"8899"==$scope.user.otp)&&(updates={},rightOtp=!0,updates["users/"+uid+"/mobile/number/"]=$scope.user.mobile,updates["users/"+uid+"/mobile/verified/"]=!0,db.ref().update(updates).then(function(){$scope.data={},$timeout(function(){$scope.login.mobile=!1,$scope.login.welcome=!0,$scope.process=!1},500)}));rightOtp||(console.log("h"),$scope.process=!1,$scope.loadingMsg="Invalid OTP")}}),app.directive("reviewRatings",reviewRatings),app.service("imageUrl",function(){return{getUrl:function(id,defer){return db.ref("images/"+id).once("value",function(snapshot){var url="";snapshot.val()&&(snapshot.val().cdn?(url="http://cdn.roofpik.com/image/"+snapshot.val().path+"/"+snapshot.val().imgName+"-m.jpg",defer.resolve(url)):(url="http://139.162.9.71/images/"+snapshot.val().imgName+".jpg",defer.resolve(url)))}),defer.promise}}});var amenitiesType={basic:{present:!1,name:"Basic",hrefLink:"#basic"},convenience:{present:!1,name:"Convenience",hrefLink:"#convenience"},entertainment:{present:!1,name:"Entertainment",hrefLink:"#entertainment"},safety:{present:!1,name:"Safety",hrefLink:"#safety"},others:{present:!1,name:"Others",hrefLink:"#others"},sports:{present:!1,name:"Sports",hrefLink:"#sports"}},amenities={basic:{carParking:{name:"Car Parking",img:"images/icons/car-parking.png"},cctv:{name:"CCTV",img:"images/icons/cctv.png"},clubhouse:{name:"Clubhouse",img:"images/icons/clubhouse.png"},fireProtection:{name:"Fire Protection",img:"images/icons/fire.png"},gym:{name:"Gym",img:"images/icons/gym.png"},intercom:{name:"Intercom",img:"images/icons/Intercom.png"},kidsPlayArea:{name:"Kids Play Area",img:"images/icons/kidsPlayground.png"},kidsPool:{name:"Kids Pool",img:"images/icons/Pool_2.png"},lifts:{name:"Lifts",img:"images/icons/lift.png"},parks:{name:"Parks",img:"images/icons/garden.png"},powerBackup:{name:"Power Backup",img:"images/icons/power-backup.png"},security:{name:"Security 24X7",img:"images/icons/group_full_security.png"},swimmingPool:{name:"Swimming Pool",img:"images/icons/swiming-pool.png"},videoPhone:{name:"Video Phone",img:"images/icons/smartphones.png"},waterSupply:{name:"Water Supply 24X7",img:"images/icons/water3.png"}},convenience:{badmintonCourt:{name:"Badminton Court",img:"images/icons/Tennis_court.png"},football:{name:"Football",img:"images/icons/basketball.png"},inhouseChemist:{name:"Inhouse Chemist",img:"images/icons/Inhouse-chemist.png"},inhouseGroceryStore:{name:"Inhouse Grocery Store",img:"images/icons/store.png"},inhousePlaySchool:{name:"Inhouse Play School",img:"images/icons/Bookmark.png"},inhouseRestaurant:{name:"Inhouse Restaurant",img:"images/icons/restaurant.png"},multipurposeCourt:{name:"Multipurpose Court",img:"images/icons/court.png"},squashCourt:{name:"Squash Court",img:"images/icons/balls-snooker.png"},volleyball:{name:"Volleyball",img:"images/icons/Volleyball.png"}},entertainment:{amphitheatre:{name:"Amphitheatre",img:"images/icons/Amphitheatre.png"},bowling:{name:"Bowling",img:"images/icons/bowling.png"},cafe:{name:"Cafe",img:"images/icons/cafe.png"},cardsRoom:{name:"Cards Room",img:"images/icons/card.png"},jacuzzi:{name:"Jacuzzi",img:"images/icons/Jacuzzi.png"},miniTheatre:{name:"Mini Theatre",img:"images/icons/Theatre.png"},partyHall:{name:"Party Hall",img:"images/icons/hall.png"},spaSteamSauna:{name:"Spa",img:"images/icons/spa.png"},videoGames:{name:"Video Games",img:"images/icons/video-games.png"}},safety:{gatedCommunity:{name:"Gated Community",img:"images/icons/group2.png"},guardAtLiftLobby:{name:"Guard At Lift Lobby",img:"images/icons/Elevator.png"},guestAccomodation:{name:"Guest Accomodation",img:"images/icons/hotel.png"},petArea:{name:"Pet Area",img:"images/icons/miscellaneous-62.png"},smartCardBiometric:{name:"SmartCard/Biometric",img:"images/icons/smart-card.png"},visitorParking:{name:"Visitor Parking",img:"images/icons/Parking.png"}},others:{indoorGames:{name:"Indoor Games",img:"images/icons/chess.png"},library:{name:"Library",img:"images/icons/Library.png"},maintenanceStaff:{name:"Maintenance Staff",img:"images/icons/group_full_security.png"},rainWaterHarvesting:{name:"Rain Water Harvesting",img:"images/icons/weather-04.png"},wasteDisposal:{name:"Waste Disposal",img:"images/icons/wastedisposal.png"}},sports:{basketballCourt:{name:"Basketball Court",img:"images/icons/basketball.png"},cricket:{name:"Cricket",img:"images/icons/cricket.png"},golfCourseFacing:{name:"Golf Course Facing",img:"images/icons/1golf.png"},golfPutting:{name:"Golf Putting",img:"images/icons/golf.png"},joggingTrack:{name:"Jogging Track",img:"images/icons/walk.png"},skatingRink:{name:"Skating Rink",img:"images/icons/icon-skate.png"},snookerPool:{name:"Snooker/Pool",img:"images/icons/balls-snooker.png"},tableTennis:{name:"Table Tennis",img:"images/icons/court.png"},tennisCourt:{name:"Tennis Court",img:"images/icons/Tennis_court.png"}}};app.controller("homeCtrl",function($scope,$state,$timeout){$(".modal").modal("close"),$(".parallax").parallax()}),app.controller("searchCtrl",function($scope,$timeout,$http,$state,$window){$scope.projsearch={},$scope.projsearch.status=!1;var projdefault=[{name:"Apartments",subtitle:"in Gurgaon",key:"apartment",category:"default"},{name:"Villa",subtitle:"in Gurgaon",key:"villa",category:"default"},{name:"Row House",subtitle:"in Gurgaon",key:"rowhouse",category:"default"},{name:"Penthouse",subtitle:"in Gurgaon",key:"penthouse",category:"default"}];$scope.projsearchFocus=function(){$scope.projsearch.status=!0,$scope.projsearch.txt||$scope.projsearch.locfilter||($scope.projsearch.data=projdefault)},$scope.projsearchBlur=function(){$timeout(function(){$scope.projsearch.status=!1},200)},$scope.getprojitem=function(item){"default"==item.category||"residential"==item.category?$scope.projsearch.txt=item.name:"locSearch"==item.category&&($scope.projsearch.txt=item.name+" "+item.subtitle),$timeout(function(){"default"==item.category?$window.location.href="/#/search/2017/property/gurgaon/residential/all?ptype="+item.key:"residential"==item.category?$window.location.href=item.url:"locSearch"==item.category&&($window.location.href=item.url+"&ptype="+item.ptype)},500)};var textStart=0;$scope.getprojsearch=function(){$scope.projsearch.txt.length>0&&0==textStart&&($scope.projsearch.loading=!0,$http({url:"http://139.162.9.71/api/mainSearch",method:"POST",params:{val:$scope.projsearch.txt}}).then(function(response){textStart=0,$scope.projsearch.loading=!1,200==response.data.status&&($scope.projsearch.data=response.data.items)}))},$scope.locsearch={},$scope.locsearch.status=!1;var locdefault=[{name:"Sohna Road",subtitle:"in Gurgaon",key:"-KfM5tQ-UKt6DtrWtzeE",category:"micro"},{name:"Golf Course Extn Road",subtitle:"in Gurgaon",key:"-KfQiNMHw7UE1alv1hSr",category:"micro"},{name:"Sector 49",subtitle:"in Gurgaon",key:"-KfRCJ0c4jveG4gkRj2_",category:"locality"},{name:"Sector 48",subtitle:"in Gurgaon",key:"-KfRC32KzT4Tjo0O14kI",category:"locality"}],locProjTxt=[{name:"All Projects in",subtitle:"",url:"",category:"locSearch",ptype:""},{name:"Apartments in",subtitle:"",url:"",category:"locSearch",ptype:"apartment"},{name:"Villas in",subtitle:"",url:"",category:"locSearch",ptype:"villa"},{name:"Pent House in",subtitle:"",url:"",category:"locSearch",ptype:"penthouse"},{name:"Row House in",subtitle:"",url:"",category:"locSearch",ptype:"rowhouse"}];$scope.locsearchFocus=function(){$scope.locsearch.status=!0,$scope.locsearch.txt||($scope.locsearch.data=locdefault,$scope.projsearch.locfilter=!1)},$scope.locsearchBlur=function(){$timeout(function(){$scope.locsearch.status=!1},200)};var selectLocation;$scope.getlocitem=function(item){"micro"==item.category?filter="micro":"locality"==item.category&&(filter="loc"),selectLocation=item,$scope.locsearch.txt=item.name;for(locProjItem in locProjTxt)locProjTxt[locProjItem].subtitle=item.name,locProjTxt[locProjItem].url="/#/search/2017/property/gurgaon/residential/all?"+filter+"="+item.key;$scope.projsearch.locfilter=!0,$scope.projsearch.data=locProjTxt,$("#projsearch").focus()};var textStart=0;$scope.getlocsearch=function(){$scope.projsearch.locfilter=!1,$scope.locsearch.txt.length>2&&0==textStart&&($scope.locsearch.loading=!0,$http({url:"http://139.162.9.71/api/searchLocation",method:"POST",params:{val:$scope.locsearch.txt}}).then(function(response){textStart=0,$scope.locsearch.loading=!1,200==response.data.status&&($scope.locsearch.data=response.data.items)}))}}),app.controller("writeReviewCtrl",function($scope,$timeout,$stateParams,$rootScope,$http,$location){function initialize(){$scope.data={},$scope.data.textlength=0,$scope.data.text="",$scope.data.textcount=!1,$scope.review={},$scope.review.main={},$scope.review.closeby={},$scope.review.extra={},$scope.review.mainrating={},$scope.review.other={},$scope.review.project={},$scope.review.user={},user={},$scope.validate=!1,$scope.data.textcount=!0}function getProjects(){$scope.review.project={},$http({url:"http://139.162.9.71/api/projLocSearch",method:"POST",params:{val:$scope.searchtxt}}).then(function(response){$scope.projectsData=!0,$scope.allData=response.data.items.data})}function checkcloseby(){var d=["hospital","market","school"];for(i in d)$scope.review.closeby[d[i]]||($scope.review.closeby[d[i]]=!1)}function checkmainrating(){var d=["amenities","greenry","infrastructure","parking","security"];for(i in d)$scope.review.mainrating[d[i]]||($scope.review.mainrating[d[i]]=!1)}function checkextra(){var d=["electricity","layout","location","transport","water"];for(i in d)$scope.review.extra[d[i]]||($scope.review.extra[d[i]]=!1)}function checkmain(){$scope.review.main.anonymous=!1,$scope.review.main.block=!1,$scope.review.main.created=(new Date).getTime(),$scope.review.main.updated=$scope.review.main.created,$scope.review.main.source="website",$scope.review.main.status="uploaded",$scope.review.main.mode="desktop",$scope.review.main.key=user.uid}function checkmandatory(){return $scope.validate=!0,result=!0,(null==$scope.review.user.type||null==$scope.review.user.age||null==$scope.review.user.gender||null==$scope.review.user.livedwith||null==$scope.review.user.house||null==$scope.review.user.block||"Click to rate"==$scope.ratingTxt.overall||null==$scope.review.main.title||null==$scope.review.main.detail)&&(result=!1,$("html, body").animate({scrollTop:0},"fast")),(""==$scope.review.user.age||""==$scope.review.user.house||""==$scope.review.user.block||""==$scope.review.main.title||""==$scope.review.main.detail)&&(result=!1,$("html, body").animate({scrollTop:0},"fast")),result&&(null==$scope.review.main.detail?(result=!1,swal({title:"Required data Missing",text:"Minimum 100 charactes required in review text",type:"error"})):$scope.review.main.detail.length<100?(result=!1,$("html, body").animate({scrollTop:0},"fast"),swal({title:"Required data Missing",text:"Minimum 100 charactes required in review text",type:"error"})):null==$scope.review.project.key?(result=!1,$("html, body").animate({scrollTop:0},"fast")):null==user.uid&&(result=!1,$("html, body").animate({scrollTop:0},"fast"))),result}var user,cityId="-KYJONgh0P98xoyPPYm9",countryId="-K_43TEI8cBodNbwlKqJ";initialize(),$location.search().key&&($scope.review.project.key=$location.search().key),$location.search().name&&($scope.review.project.name=$location.search().name,$scope.projectsData=!1,$scope.searchtxt=$location.search().name,$timeout(function(){Materialize.updateTextFields()},500)),$location.search().tyep&&($scope.review.project.type=$location.search().type),firebase.auth().onAuthStateChanged(function(data){data?(user=data,console.log(user)):($scope.review.user={},$timeout(function(){$("#login_signup_popup").modal({dismissible:!1}),$("#login_signup_popup").modal("open"),$(".modal-close").hide()},2e3))}),$scope.searchData=function(){getProjects()},$scope.selectedProj=function(item){$scope.projectsData=!1,$scope.searchtxt=item.name,$scope.review.project.key=item.key,$scope.review.project.name=item.name,$scope.review.project.type=item.category,Materialize.updateTextFields()},$scope.data.textcount=!0,$scope.reviewText=function(){$scope.review.main.detail?($scope.data.textlength=$scope.review.main.detail.length,$scope.data.textlength>=100?($scope.data.textcount=!0,$("#textarea1").removeClass("validate"),$("#textcount").removeClass("validate")):($scope.data.textcount=!1,$("#textarea1").addClass("validate"),$("#textcount").addClass("validate"))):($scope.data.textcount=!1,$scope.data.textlength=0)},cityId="-KYJONgh0P98xoyPPYm9",countryId="-K_43TEI8cBodNbwlKqJ",ratingTxtVal=["Click to rate","Terrible","Poor","Average","Good","Excellent"],$scope.ratingParams=[{name:"Security",id:2,rtxt:ratingTxtVal[0]},{name:"Amenities",id:3,rtxt:ratingTxtVal[0]},{name:"Open and green areas",id:4,rtxt:ratingTxtVal[0]},{name:"Convenience of parking",id:5,rtxt:ratingTxtVal[0]},{name:"Infrastructure",id:6,rtxt:ratingTxtVal[0]}],$scope.ratingTxt={overall:ratingTxtVal[0],security:ratingTxtVal[0],amenities:ratingTxtVal[0],green:ratingTxtVal[0],parking:ratingTxtVal[0],infrastructure:ratingTxtVal[0]},$scope.ratingsObject={iconOnColor:"rgb(43, 187, 173)",iconOffColor:"rgb(140, 140, 140)",rating:0,minRating:0,readOnly:!1,callback:function(rating,index){$scope.ratingsCallback(rating,index)}},$scope.ratingsCallback=function(rating,index){1==index?($scope.review.main.rating=rating,$scope.ratingTxt.overall=ratingTxtVal[rating]):2==index?($scope.review.mainrating.security=rating,$scope.ratingParams[index-2].rtxt=ratingTxtVal[rating]):3==index?($scope.review.mainrating.amenities=rating,$scope.ratingParams[index-2].rtxt=ratingTxtVal[rating]):4==index?($scope.review.mainrating.greenry=rating,$scope.ratingParams[index-2].rtxt=ratingTxtVal[rating]):5==index?($scope.review.mainrating.parking=rating,$scope.ratingParams[index-2].rtxt=ratingTxtVal[rating]):6==index&&($scope.review.mainrating.infrastructure=rating,$scope.ratingParams[index-2].rtxt=ratingTxtVal[rating])},$scope.submitReview=function(){if(checkcloseby(),checkmainrating(),checkextra(),checkmain(),validate=checkmandatory(),validate){$scope.review.user.uname=user.displayName,$scope.review.user.uid=user.uid,$scope.review.user.photoURL=user.photoURL;var updates={};url="allreviews/data/country/"+countryId+"/city/"+cityId+"/"+$scope.review.project.type+"/"+$scope.review.project.key,updates[url+"/"+user.uid]=$scope.review,updates["allreviews/users/"+user.uid+"/"+$scope.review.project.key]=$scope.review.project,db.ref().update(updates).then(function(){$timeout(function(){swal("Review Submitted","Your review has been successfully submitted","success")},0)})}else console.log("error")},$("select").material_select()}),app.controller("projectDetailsCtrl",function($scope,$timeout,$q,imageUrl,$stateParams,$location){function generateConfigurations(config){for(key in config)$scope.configurations[config[key].bhk]?config[key].type==$scope.configurations[config[key].bhk].type?(config[key].hrefLink="#area"+config[key].area,$scope.configurations[config[key].bhk].units[config[key].area]=config[key]):($scope.configurations[config[key].bhk+"a"]={bhk:config[key].bhk,type:config[key].type,hrefLink:"#bhk"+config[key].bhk+"a",units:{}},config[key].hrefLink="#area"+config[key].area,$scope.configurations[config[key].bhk].units[config[key].area]=config[key]):($scope.configurations[config[key].bhk]={bhk:config[key].bhk,type:config[key].type,hrefLink:"#bhk"+config[key].bhk,units:{}},config[key].hrefLink="#area"+config[key].area,$scope.configurations[config[key].bhk].units[config[key].area]=config[key]);console.log($scope.configurations);var start=0,unitStart=0;for(key in $scope.configurations)if(0==start){$scope.configurations[key].selected=!0;for(key1 in $scope.configurations[key].units)0==unitStart?($scope.configurations[key].units[key1].selected=!0,unitStart=1):$scope.configurations[key].units[key1].selected=!1;start=1}else{$scope.configurations[key].selected=!1;for(key1 in $scope.configurations[key].units)0==unitStart?($scope.configurations[key].units[key1].selected=!0,unitStart=1):$scope.configurations[key].units[key1].selected=!1}$timeout(function(){$("ul.tabs").tabs()},100)}function generateAmenitiesList(amenities){for(key in amenities)for(key1 in amenities[key])if("NA"!=amenities[key][key1]||"No"!=amenities[key][key1])try{$scope.amenitiesType[key].present=!0}catch(err){console.log(key,key1)}for(key in $scope.amenitiesType)$scope.amenitiesType[key].present&&($scope.showAmenities=!0);$timeout(function(){$("ul.tabs").tabs()},500)}$scope.countryId="-K_43TEI8cBodNbwlKqJ",$scope.cityId="-KYJONgh0P98xoyPPYm9",$scope.micromarketId=$location.search().m,$scope.localityId=$location.search().l,$scope.projectId=$location.search().p,$scope.pros=[],$scope.cons=[],$scope.specifications={},$scope.allAmenities=amenities,$scope.amenitiesType=amenitiesType,db.ref("project/country/"+$scope.countryId+"/city/"+$scope.cityId+"/residential/micromarket/"+$scope.micromarketId+"/locality/"+$scope.localityId+"/projects/"+$scope.projectId).once("value",function(snapshot){$scope.project=snapshot.val(),console.log($scope.project.images),$scope.images={};for(img in $scope.project.images)db.ref("images/"+img).once("value",function(data){item=data.val(),$scope.images[item.key]={url:"http://cdn.roofpik.com/image/"+item.path+item.imgName+"-m.jpg"},"cover"==item.imgCat&&($scope.cover="http://cdn.roofpik.com/image/"+item.path+item.imgName+"-xs.jpg",$scope.coverl="http://cdn.roofpik.com/image/"+item.path+item.imgName+"-xl.jpg",$("#cover-l").on("load",function(){$("#cover-xs").addClass("hidden"),$("#cover-l").removeClass("hidden")}),$("#zoomIn").on("load",function(){$("#zoomIn").removeClass("hidden")})),$(".gallery").each(function(){$(this).magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0}})})});$scope.showSpecifications=function(){$("#more_specifications").modal(),$("#more_specifications").modal("open")},$scope.project.amenities&&generateAmenitiesList($scope.project.amenities),$scope.project.units&&generateConfigurations($scope.project.units);for(key in $scope.project.specifications){var x=camelCaseToTitleCase(key);$scope.specifications[x]={};for(key1 in $scope.project.specifications[key]){var y=camelCaseToTitleCase(key1);$scope.specifications[x][y]=$scope.project.specifications[key][key1]}}$scope.project.highlights&&($scope.project.highlights.pros&&($scope.pros=$scope.project.highlights.pros.split("*")),$scope.project.highlights.cons&&($scope.cons=$scope.project.highlights.cons.split("*"))),$scope.project.general.about&&($scope.project.general.about.length>500?($scope.project.general.about1=$scope.project.general.about.substring(0,500),$scope.project.general.about2=$scope.project.general.about.substring(501,$scope.project.general.about.length)):$scope.project.general.about1=$scope.project.general.about)}),$scope.configurations={},$scope.selectConfig=function(config){unitStart=0;for(key in $scope.configurations)if(config.hrefLink==$scope.configurations[key].hrefLink){$scope.configurations[key].selected=!0;for(key1 in $scope.configurations[key].units)0==unitStart?($scope.configurations[key].units[key1].selected=!0,unitStart=1):$scope.configurations[key].units[key1].selected=!1}else{$scope.configurations[key].selected=!1;for(key1 in $scope.configurations[key].units)$scope.configurations[key].units[key1].selected=!1}$timeout(function(){$("ul.tabs").tabs()},500)},$scope.selectUnit=function(config,unit){for(key in $scope.configurations)if(config.hrefLink==$scope.configurations[key].hrefLink)for(key1 in $scope.configurations[key].units)unit.hrefLink==$scope.configurations[key].units[key1].hrefLink?$scope.configurations[key].units[key1].selected=!0:$scope.configurations[key].units[key1].selected=!1;
},$scope.submitQuery=function(){console.log($scope.query),$scope.query.projectId=$scope.projectId,$scope.query.projectName=$scope.project.name,$scope.query.cityId=$scope.cityId,$scope.query.micromarketId=$scope.micromarketId,$scope.query.localityId=$scope.localityId,db.ref("query").push($scope.query).then(function(){swal("Query Submitted","Our executives will call you back","success")})}}),app.controller("listingCtrl",function($scope,$timeout,$stateParams,$http,$state,$location,$window){function consFilter(){$(".fd-load").addClass("blur"),fil="";for(key in $scope.data)$scope.data[key]&&(""==fil?fil="?"+key+"="+$scope.data[key]:fil=fil+"&"+key+"="+$scope.data[key],$scope.selected[key]?$scope.selected[key][$scope.data[key]]=!0:($scope.selected[key]={},$scope.selected[key][$scope.data[key]]=!0));if(history.pushState){var newurl=window.location.href.split("?")[0]+fil;window.history.pushState({path:newurl},"",newurl)}getProjects()}function getProjects(){$http({url:"http://139.162.9.71/api/projectFilter",method:"POST",params:$scope.data}).then(function(response){$(".fd-load").removeClass("blur"),$scope.projects=response.data.items,$timeout(function(){},1e3)})}function getLocations(){db.ref("locations/country/-K_43TEI8cBodNbwlKqJ/locality/city/-KYJONgh0P98xoyPPYm9/micromarket").once("value",function(snapshot){$timeout(function(){for(key in snapshot.val())for(key1 in snapshot.val()[key].places)$scope.locations.push(snapshot.val()[key].places[key1]);getLocalities()},0)})}function getLocalities(){db.ref("locations/country/-K_43TEI8cBodNbwlKqJ/micromarket/city/-KYJONgh0P98xoyPPYm9/places").once("value",function(snapshot){$timeout(function(){for(key in snapshot.val())$scope.micromarkets.push(snapshot.val()[key]);getBuilders()},0)})}function getBuilders(){db.ref("builder").once("value",function(snapshot){$timeout(function(){for(key in snapshot.val())$scope.builders.push(snapshot.val()[key])},0)})}function tspaces(val){return val.replace(/\s+/g,"-").toLowerCase()}$("html,body").scrollTop(0),$(".button-collapse1").sideNav({menuWidth:300,edge:"right",closeOnClick:!0,draggable:!0}),$timeout(function(){var slider=document.getElementById("price"),slider2=document.getElementById("price2");$location.search().rmin?rstart=$location.search().rmin:rstart=0,$location.search().rmax?rend=$location.search().rmax:rend=2e5,noUiSlider.create(slider,{start:[rstart,rend],tooltips:!0,connect:!0,step:5e3,range:{min:5e3,max:2e5}}),slider.noUiSlider.on("change",function(){val=slider.noUiSlider.get();var inputMin=$("#minP");inputMin.val(parseFloat(val[0],10)),inputMin.trigger("input");var inputMax=$("#maxP");inputMax.val(parseFloat(val[1],10)),inputMax.trigger("input")}),noUiSlider.create(slider2,{start:[rstart,rend],tooltips:!0,connect:!0,step:5e3,range:{min:5e3,max:2e5}}),slider2.noUiSlider.on("change",function(){val=slider2.noUiSlider.get();var inputMin=$("#minP");inputMin.val(parseFloat(val[0],10)),inputMin.trigger("input");var inputMax=$("#maxP");inputMax.val(parseFloat(val[1],10)),inputMax.trigger("input")}),$(".modal").modal()},500),$scope.data={loc:"",micro:"",ptype:"",bhk:"",rmin:"",rmax:"",builder:"",category:""},$scope.selected={};for(key in $location.search())$location.search()[key]&&("rmin"==key||"rmax"==key?$scope.data[key]=parseInt($location.search()[key]):$scope.data[key]=$location.search()[key]);$scope.moreFilters=function(){$("#modal1").modal("open")},$scope.closeFilter=function(){$("#modal1").modal("close")},$scope.minChange=function(){consFilter()},$scope.maxChange=function(){consFilter()};for(key in $scope.data)if($scope.data[key]){l=$scope.data[key].toString().split(","),$scope.selected[key]={};for(i in l)$scope.selected[key][l[i]]=!0}getProjects(),$scope.visit={},$scope.visitDate=function(){console.log($scope.visit.date)};var count=0;$scope.addFilter=function(id,type){if($scope.data[type]){filter=$scope.data[type].split(",");for(index in filter)filter[index]==id&&(count+=1,filter.splice(index,1));0==count&&filter.push(id.toString()),$scope.data[type]=filter.join()}else $scope.data[type]=id.toString();consFilter()},$scope.categories=[{name:"Best Amenities",id:"bestAmenities"},{name:"Luxury",id:"luxury"},{name:"Affordable",id:"affordable"},{name:"Ultra Luxury",id:"ultraLuxury"},{name:"Pet Friendly",id:"petFriendly"},{name:"Downtown",id:"downtown"},{name:"Bachelors",id:"bachelors"},{name:"Senior Living",id:"seniorLiving"}],$scope.propertyTypes=[{name:"Apartments",id:"apartment"},{name:"Villas",id:"villa"},{name:"Penthouse",id:"penthouse"},{name:"Row House",id:"rowhouse"}],$scope.micromarkets=[],$scope.locations=[],$scope.builders=[],getLocations(),$scope.scheduleVisit=function(proj){$scope.visit.project={},$scope.visit.project.key=proj.key,$scope.visit.project.location=proj.location,$scope.visit.project.location=proj.location,$scope.visit.project.name=proj.name},$scope.submitQuery=function(){updates={};var newPostKey=firebase.database().ref().child("openQuery").push().key;$scope.visit.created=(new Date).getTime(),$scope.visit.status="submitted",updates["/openQuery/country/-K_43TEI8cBodNbwlKqJ/city/-KYJONgh0P98xoyPPYm9/query/"+newPostKey]=$scope.visit,db.ref().update(updates).then(function(){Materialize.toast("You have successfully submit details!",3e3,"rounded")})},$scope.writeReview=function(proj){$state.go("write-review",{key:proj.key,name:proj.name,type:"residential"})},$scope.showProjDetails=function(item){$window.location.href="#/rent/property/2017/gurgaon/residential/"+tspaces(item.location.microname)+"/"+tspaces(item.location.locname)+"/"+tspaces(item.builder)+"/"+tspaces(item.name)+"-project?l="+item.location.lockey+"&m="+item.location.microkey+"&p="+item.key}}),app.controller("micromarketDetailsCtrl",function($scope,$timeout,$stateParams,$http,$q,imageUrl){function initMap(){var map,bounds=new google.maps.LatLngBounds,mapOptions={mapTypeId:"roadmap"};map=new google.maps.Map(document.getElementById("mapCanvas"),mapOptions),map.setTilt(50);var marker,i,markers=[[$scope.micromarket.name,$scope.micromarket.lat,$scope.micromarket.lng]],infoWindowContent=[['<div class="row relative mgbn"><div class="col s4 imglist pdb10"><a href=""> <img src="'+$scope.coverImage+'" class="responsive-img"></a></div><div class="col s6 pdln"><div class="truncate grey-text ft12">lorem ipsum</div><h2 class="ft18 b mgbn mgt5 truncate"><a href="" class="redt">'+$scope.micromarket.name+'</a></h2><h6 class="mgbn ft12 truncate b text-darken-2 mgt5"><a href="" class="grey-text"> Golf Course Road, Sector 56</a></h6><div class="grey-text mgt5 ft12">lorem ipsum</div></div><div class="col s2 pdln right-align"><span class="pdl10 pdr10 b grnbg white-text">4.7</span><div class="ft11 grey-text mgt5">7832 votes </div><div class="ft11 grey-text">4233 reviews</div></div></div>']],infoWindow=new google.maps.InfoWindow({});for(i=0;i<markers.length;i++){var position=new google.maps.LatLng(markers[i][1],markers[i][2]);bounds.extend(position),marker=new google.maps.Marker({position:position,map:map,title:markers[i][0],icon:markers[i][3],animation:google.maps.Animation.DROP}),google.maps.event.addListener(marker,"mouseover",function(marker,i){return function(){infoWindow.setContent(infoWindowContent[i][0]),infoWindow.open(map,marker)}}(marker,i)),map.fitBounds(bounds)}var boundsListener=google.maps.event.addListener(map,"bounds_changed",function(event){this.setZoom(13),google.maps.event.removeListener(boundsListener)})}$scope.micromarket={},$scope.pros=[],$scope.cons=[],db.ref("locations/country/-K_43TEI8cBodNbwlKqJ/micromarket/city/"+$stateParams.city+"/places/"+$stateParams.micro).once("value",function(snapshot){$timeout(function(){if(snapshot.val()){$scope.micromarket=snapshot.val();var defer=$q.defer(),t=imageUrl.getUrl($scope.micromarket["cover-image"],defer);t.then(function(response){$scope.coverImage=response}),$scope.micromarket.about&&($scope.micromarket.about.length>500?($scope.micromarket.about1=$scope.micromarket.about.substring(0,500),$scope.micromarket.about2=$scope.micromarket.about.substring(501,$scope.micromarket.about.length)):$scope.micromarket.about1=$scope.micromarket.about),$scope.micromarket.highlight&&($scope.micromarket.highlight.pros&&($scope.pros=$scope.micromarket.highlight.pros.split("*")),$scope.micromarket.highlight.cons&&($scope.cons=$scope.micromarket.highlight.cons.split("*")))}},0)}),$(document).ready(function(){$("ul.tabs").tabs(),Materialize.updateTextFields(),$(".button-collapse").sideNav({menuWidth:300,edge:"left",closeOnClick:!0,draggable:!0}),$("select").material_select(),$(".slider").slider(),$(".dropdown-button").dropdown(),$(".carousel").carousel(),$(".modal").modal()}),$(".gallery").each(function(){$(this).magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0}})}),$(function(){var menu=$("#fixsub_hd"),pos=menu.offset();$(window).scroll(function(){$(this).scrollTop()>pos.top+menu.height()&&menu.hasClass("displayn")?menu.fadeOut("fast",function(){$(this).removeClass("displayn").addClass("fixed").fadeIn("fast")}):$(this).scrollTop()<=pos.top&&menu.hasClass("fixed")&&menu.fadeOut("fast",function(){$(this).removeClass("fixed").addClass("displayn").fadeIn("fast")})})}),$scope.openModal=function(){$("#view_map_popup").modal("open"),initMap()}}),app.controller("localityDetailsCtrl",function($scope,$timeout,$stateParams,$http,$q,imageUrl){function initMap(){var map,bounds=new google.maps.LatLngBounds,mapOptions={mapTypeId:"roadmap"};map=new google.maps.Map(document.getElementById("mapCanvas"),mapOptions),map.setTilt(50);var marker,i,markers=[[$scope.locality.name,$scope.locality.lat,$scope.locality.lng]],infoWindowContent=[['<div class="row relative mgbn"><div class="col s4 imglist pdb10"><a href=""> <img src="'+$scope.coverImage+'" class="responsive-img"></a></div><div class="col s6 pdln"><div class="truncate grey-text ft12">lorem ipsum</div><h2 class="ft18 b mgbn mgt5 truncate"><a href="" class="redt">'+$scope.locality.name+'</a></h2><h6 class="mgbn ft12 truncate b text-darken-2 mgt5"><a href="" class="grey-text"> Golf Course Road, Sector 56</a></h6><div class="grey-text mgt5 ft12">lorem ipsum</div></div><div class="col s2 pdln right-align"><span class="pdl10 pdr10 b grnbg white-text">4.7</span><div class="ft11 grey-text mgt5">7832 votes </div><div class="ft11 grey-text">4233 reviews</div></div></div>']],infoWindow=new google.maps.InfoWindow({});for(i=0;i<markers.length;i++){var position=new google.maps.LatLng(markers[i][1],markers[i][2]);bounds.extend(position),marker=new google.maps.Marker({position:position,map:map,title:markers[i][0],icon:markers[i][3],animation:google.maps.Animation.DROP}),google.maps.event.addListener(marker,"mouseover",function(marker,i){return function(){infoWindow.setContent(infoWindowContent[i][0]),infoWindow.open(map,marker)}}(marker,i)),map.fitBounds(bounds)}var boundsListener=google.maps.event.addListener(map,"bounds_changed",function(event){this.setZoom(13),google.maps.event.removeListener(boundsListener)})}$scope.locality={},$scope.pros=[],$scope.cons=[],db.ref("locations/country/-K_43TEI8cBodNbwlKqJ/locality/city/"+$stateParams.city+"/micromarket/"+$stateParams.micro+"/places/"+$stateParams.loc).once("value",function(snapshot){$timeout(function(){if(snapshot.val()){$scope.locality=snapshot.val();var defer=$q.defer(),t=imageUrl.getUrl($scope.locality["cover-image"],defer);t.then(function(response){$scope.coverImage=response}),$scope.locality.about&&($scope.locality.about.length>500?($scope.locality.about1=$scope.locality.about.substring(0,500),$scope.locality.about2=$scope.locality.about.substring(501,$scope.locality.about.length)):$scope.locality.about1=$scope.locality.about),$scope.locality.highlight&&($scope.locality.highlight.pros&&($scope.pros=$scope.locality.highlight.pros.split("*")),$scope.locality.highlight.cons&&($scope.cons=$scope.locality.highlight.cons.split("*")))}},0)}),$(document).ready(function(){$("ul.tabs").tabs(),Materialize.updateTextFields(),$(".button-collapse").sideNav({menuWidth:300,edge:"left",closeOnClick:!0,draggable:!0}),$("select").material_select(),$(".slider").slider(),$(".dropdown-button").dropdown(),$(".carousel").carousel(),$(".modal").modal()}),$(".gallery").each(function(){$(this).magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0}})}),$(function(){var menu=$("#fixsub_hd"),pos=menu.offset();$(window).scroll(function(){$(this).scrollTop()>pos.top+menu.height()&&menu.hasClass("displayn")?menu.fadeOut("fast",function(){$(this).removeClass("displayn").addClass("fixed").fadeIn("fast")}):$(this).scrollTop()<=pos.top&&menu.hasClass("fixed")&&menu.fadeOut("fast",function(){$(this).removeClass("fixed").addClass("displayn").fadeIn("fast")})})}),$scope.openModal=function(){$("#view_map_popup").modal("open"),initMap()}}),app.controller("cityDetailsCtrl",function($scope,$timeout,$stateParams,$http,$q,imageUrl){function initMap(){var map,bounds=new google.maps.LatLngBounds,mapOptions={mapTypeId:"roadmap"};map=new google.maps.Map(document.getElementById("mapCanvas"),mapOptions),map.setTilt(50);var marker,i,markers=[[$scope.city.name,$scope.city.lat,$scope.city.lng]],infoWindowContent=[['<div class="row relative mgbn"><div class="col s4 imglist pdb10"><a href=""> <img src="'+$scope.coverImage+'" class="responsive-img"></a></div><div class="col s6 pdln"><div class="truncate grey-text ft12">lorem ipsum</div><h2 class="ft18 b mgbn mgt5 truncate"><a href="" class="redt">'+$scope.city.name+'</a></h2><h6 class="mgbn ft12 truncate b text-darken-2 mgt5"><a href="" class="grey-text"> Golf Course Road, Sector 56</a></h6><div class="grey-text mgt5 ft12">lorem ipsum</div></div><div class="col s2 pdln right-align"><span class="pdl10 pdr10 b grnbg white-text">4.7</span><div class="ft11 grey-text mgt5">7832 votes </div><div class="ft11 grey-text">4233 reviews</div></div></div>']],infoWindow=new google.maps.InfoWindow({});for(i=0;i<markers.length;i++){var position=new google.maps.LatLng(markers[i][1],markers[i][2]);bounds.extend(position),marker=new google.maps.Marker({position:position,map:map,title:markers[i][0],icon:markers[i][3],animation:google.maps.Animation.DROP}),google.maps.event.addListener(marker,"mouseover",function(marker,i){return function(){infoWindow.setContent(infoWindowContent[i][0]),infoWindow.open(map,marker)}}(marker,i)),map.fitBounds(bounds)}var boundsListener=google.maps.event.addListener(map,"bounds_changed",function(event){this.setZoom(13),google.maps.event.removeListener(boundsListener)})}$scope.city={},$scope.pros=[],$scope.cons=[],db.ref("locations/country/-K_43TEI8cBodNbwlKqJ/city/"+$stateParams.city).once("value",function(snapshot){$timeout(function(){if(snapshot.val()){$scope.city=snapshot.val();var defer=$q.defer(),t=imageUrl.getUrl($scope.city["cover-image"],defer);t.then(function(response){$scope.coverImage=response}),$scope.city.about&&($scope.city.about.length>500?($scope.city.about1=$scope.city.about.substring(0,500),$scope.city.about2=$scope.city.about.substring(501,$scope.city.about.length)):$scope.city.about1=$scope.city.about),$scope.city.highlight&&($scope.city.highlight.pros&&($scope.pros=$scope.city.highlight.pros.split("*")),$scope.city.highlight.cons&&($scope.cons=$scope.city.highlight.cons.split("*")))}},0)}),$(document).ready(function(){$("ul.tabs").tabs(),Materialize.updateTextFields(),$(".button-collapse").sideNav({menuWidth:300,edge:"left",closeOnClick:!0,draggable:!0}),$("select").material_select(),$(".slider").slider(),$(".dropdown-button").dropdown(),$(".carousel").carousel(),$(".modal").modal()}),$(".gallery").each(function(){$(this).magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0}})}),$(function(){var menu=$("#fixsub_hd"),pos=menu.offset();$(window).scroll(function(){$(this).scrollTop()>pos.top+menu.height()&&menu.hasClass("displayn")?menu.fadeOut("fast",function(){$(this).removeClass("displayn").addClass("fixed").fadeIn("fast")}):$(this).scrollTop()<=pos.top&&menu.hasClass("fixed")&&menu.fadeOut("fast",function(){$(this).removeClass("fixed").addClass("displayn").fadeIn("fast")})})}),$scope.openModal=function(){$("#view_map_popup").modal("open"),initMap()}}),app.controller("testCtrl",function($scope,$timeout,$http,$window){$scope.projsearch={},$scope.projsearch.status=!1;var projdefault=[{name:"Apartments",subtitle:"in Gurgaon",key:"apartment",category:"default"},{name:"Villa",subtitle:"in Gurgaon",key:"villa",category:"default"},{name:"Row House",subtitle:"in Gurgaon",key:"rowhouse",category:"default"},{name:"Penthouse",subtitle:"in Gurgaon",key:"penthouse",category:"default"}];$scope.projsearchFocus=function(){console.log("called"),$scope.projsearch.status=!0,$scope.projsearch.txt||$scope.projsearch.locfilter||($scope.projsearch.data=projdefault)},$scope.projsearchBlur=function(){$timeout(function(){$scope.projsearch.status=!1},200)},$scope.getprojitem=function(item){"default"==item.category||"residential"==item.category?$scope.projsearch.txt=item.name:"locSearch"==item.category&&($scope.projsearch.txt=item.name+" "+item.subtitle),console.log(item.url),$timeout(function(){"default"==item.category?$window.location.href="/#/search/2017/property/gurgaon/residential/all?ptype="+item.key:"residential"==item.category?$window.location.href=item.url:"locSearch"==item.category&&($window.location.href=item.url)},1e3)};var textStart=0;$scope.getprojsearch=function(){$scope.projsearch.txt.length>0&&0==textStart&&($scope.projsearch.loading=!0,$http({url:"http://139.162.9.71/api/mainSearch",method:"POST",params:{val:$scope.projsearch.txt}}).then(function(response){textStart=0,$scope.projsearch.loading=!1,200==response.data.status&&($scope.projsearch.data=response.data.items)}))},$scope.locsearch={},$scope.locsearch.status=!1;var locdefault=[{name:"Sohna Road",subtitle:"in Gurgaon",key:"-KfM5tQ-UKt6DtrWtzeE",category:"micro"},{name:"Golf Course Extn Road",subtitle:"in Gurgaon",key:"-KfQiNMHw7UE1alv1hSr",category:"micro"},{name:"Sector 49",subtitle:"in Gurgaon",key:"-KfRCJ0c4jveG4gkRj2_",category:"locality"},{name:"Sector 48",subtitle:"in Gurgaon",key:"-KfRC32KzT4Tjo0O14kI",category:"locality"}],locProjTxt=[{name:"All Projects in",subtitle:"",url:"",category:"locSearch"},{name:"Apartments in",subtitle:"",url:"",category:"locSearch"},{name:"Villas in",subtitle:"",url:"",category:"locSearch"},{name:"Pent House in",subtitle:"",url:"",category:"locSearch"},{name:"Row House in",subtitle:"",url:"",category:"locSearch"}];$scope.locsearchFocus=function(){$scope.locsearch.status=!0,$scope.locsearch.txt||($scope.locsearch.data=locdefault,$scope.projsearch.locfilter=!1)},$scope.locsearchBlur=function(){$timeout(function(){$scope.locsearch.status=!1},200)},$scope.getlocitem=function(item){$scope.locsearch.txt=item.name;for(locProjItem in locProjTxt)locProjTxt[locProjItem].subtitle=item.name,locProjTxt[locProjItem].url="/#/search/2017/property/gurgaon/residential/all?ptype="+item.key;$scope.projsearch.locfilter=!0,$scope.projsearch.data=locProjTxt,$("#projsearch").focus()};var textStart=0;$scope.getlocsearch=function(){$scope.projsearch.locfilter=!1,$scope.locsearch.txt.length>2&&0==textStart&&($scope.locsearch.loading=!0,$http({url:"http://139.162.9.71/api/searchLocation",method:"POST",params:{val:$scope.locsearch.txt}}).then(function(response){textStart=0,$scope.locsearch.loading=!1,200==response.data.status&&($scope.locsearch.data=response.data.items)}))}}),app.controller("testLoginCtrl",function($scope){$scope.status="login",$scope.fbLogin=function(){var provider=new firebase.auth.FacebookAuthProvider;provider.addScope("email"),firebase.auth().signInWithPopup(provider).then(function(result){var user=(result.credential.accessToken,result.user);$scope.data={},$scope.data.email={},$scope.data.facebook={},$scope.data.fname=user.displayName,$scope.data.uid=user.uid,$scope.data.profileImage=user.photoURL,$scope.data.createdDate=(new Date).getTime(),$scope.data.registeredFlag=!0,$scope.data.welcomeEmailSent=!1,$scope.data.email.emailAddress=user.providerData[0].email,$scope.data.email.emailVerified=!0,$scope.data.facebook.active=!0,$scope.data.facebook.fid=user.providerData[0].uid,$scope.data.facebook.photoURL=user.providerData[0].photoURL,user.providerData[0].email&&user.updateEmail(user.providerData[0].email).then(function(){$scope.status="mobile"},function(error){console.log(error)}),updates={},updates["users/"+$scope.data.uid]=$scope.data,db.ref().update(updates).then(function(){sweetAlert("Success","Thanks for Registering with Roofpik","success"),$scope.data={}})})["catch"](function(error){error.code,error.message,error.email,error.credential;sweetAlert("error",error.message,"error")})},$scope.googleLogin=function(){firebase.auth().signOut();var provider=new firebase.auth.GoogleAuthProvider;provider.addScope("https://www.googleapis.com/auth/plus.login"),provider.addScope("email"),firebase.auth().signInWithPopup(provider).then(function(result){var user=(result.credential.accessToken,result.user);$scope.data={},$scope.data.email={},$scope.data.google={},$scope.data.fname=user.displayName,$scope.data.uid=user.uid,$scope.data.profileImage=user.photoURL,$scope.data.createdDate=(new Date).getTime(),$scope.data.registeredFlag=!0,$scope.data.welcomeEmailSent=!1,$scope.data.email.emailAddress=user.providerData[0].email,$scope.data.email.emailVerified=!0,$scope.data.google.active=!0,$scope.data.google.gid=user.providerData[0].uid,$scope.data.google.photoURL=user.providerData[0].photoURL,user.providerData[0].email&&user.updateEmail(user.providerData[0].email).then(function(){},function(error){console.log(error)}),updates={},updates["users/"+$scope.data.uid]=$scope.data,db.ref().update(updates).then(function(){sweetAlert("Success","Thanks for Registering with Roofpik","success"),$scope.data={}})})["catch"](function(error){error.code,error.message,error.email,error.credential;sweetAlert(error.code,error.message,"error")})}}),app.controller("testReviewCtrl",function($scope){console.log("k"),$("select").material_select(),$scope.change=function(){console.log($scope.data)}});